<UserControl x:Class="Editor.RoomEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Editor"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="900">
  <UserControl.Resources>
    <Style x:Key="DangerButton" TargetType="Button">
      <Setter Property="Background" Value="#E53935"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Margin" Value="2"/>
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="#B71C1C"/>
        </Trigger>
      </Style.Triggers>
    </Style>
  </UserControl.Resources>
  <Grid Background="{DynamicResource WindowBackgroundBrush}">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="250"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>

    <!-- Left Panel: Room Management & Objects -->
    <StackPanel Grid.Column="0" Background="{DynamicResource ControlBackgroundBrush}">
      <!-- Room Management -->
      <GroupBox Header="Room Settings" Margin="10" Foreground="{DynamicResource PrimaryTextBrush}">
        <StackPanel Margin="5">
          <StackPanel Orientation="Horizontal" Margin="0,0,0,5"/>

          <!-- Background Settings -->
          <TextBlock Text="Background:" FontWeight="Bold" Margin="0,0,0,5"/>
          <ComboBox x:Name="BackgroundComboBox" Width="120" Margin="0,0,0,5" VerticalAlignment="Center"/>
          <CheckBox x:Name="BackgroundTiledCheckBox" Content="Tiled Background" Margin="0,0,0,5" Foreground="{DynamicResource PrimaryTextBrush}"/>
          <Button Content="Clear Background" Click="ClearBackground_Click" Padding="8,2" Margin="0,0,0,10"/>
          <TextBlock Text="Room Width:" FontWeight="Bold" Foreground="{DynamicResource PrimaryTextBrush}"/>
          <TextBox x:Name="RoomWidthTextBox" Text="800"/>
          <TextBlock Text="Room Height:" FontWeight="Bold" Foreground="{DynamicResource PrimaryTextBrush}"/>
          <TextBox x:Name="RoomHeightTextBox" Text="800"/>

          <!-- Zoom Controls -->
          <TextBlock Text="Zoom:" FontWeight="Bold" Foreground="{DynamicResource PrimaryTextBrush}" Margin="0,10,0,5"/>
          <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
            <Button Content="-" Click="ZoomOut_Click" Width="30" Margin="0,0,5,0"/>
            <Slider x:Name="ZoomSlider" Minimum="0.25" Maximum="4.0" Value="1.0" 
                    Width="100" VerticalAlignment="Center" 
                    ValueChanged="ZoomSlider_ValueChanged"/>
            <Button Content="+" Click="ZoomIn_Click" Width="30" Margin="5,0,0,0"/>
          </StackPanel>
          <TextBlock x:Name="ZoomText" Text="100%" HorizontalAlignment="Center" 
                     Foreground="{DynamicResource PrimaryTextBrush}" FontSize="10"/>
        </StackPanel>
      </GroupBox>
      <!-- Objects Tree -->
      <GroupBox Header="Objects" Margin="10" Foreground="{DynamicResource PrimaryTextBrush}">
        <StackPanel Margin="5">
          <TextBlock Text="Drag objects to place in room:" FontWeight="Bold" Margin="0,0,0,5"/>
          <TreeView x:Name="ObjectTreeView" Height="200" Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource PrimaryTextBrush}">
            <TreeView.Resources>
              <Style TargetType="TreeViewItem">
                <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
                <Setter Property="Background" Value="Transparent"/>
                <Style.Triggers>
                  <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                  </Trigger>
                  <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                  </Trigger>
                </Style.Triggers>
              </Style>
            </TreeView.Resources>
          </TreeView>
        </StackPanel>
      </GroupBox>
    </StackPanel>

    <!-- Right Panel: Room Canvas -->
    <Border Grid.Column="1"
        Margin="10"
        Background="{DynamicResource ControlBackgroundBrush}"
        CornerRadius="6">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="220"/>
        </Grid.ColumnDefinitions>

        <ScrollViewer Grid.Column="0"
                  x:Name="CanvasScrollViewer"
                  HorizontalScrollBarVisibility="Auto"
                  VerticalScrollBarVisibility="Auto">
          <Grid x:Name="CanvasContainer">
            <local:GridOverlay x:Name="GridOverlay" />
            <local:BackgroundCanvas x:Name="RoomCanvas"
                                AllowDrop="True"
                                Background="Transparent"
                                BackgroundSprite="{Binding ElementName=BackgroundComboBox, Path=SelectedItem}"
                                Tiled="{Binding ElementName=BackgroundTiledCheckBox, Path=IsChecked}"
                                MouseLeftButtonDown="RoomCanvas_MouseLeftButtonDown"
                                MouseMove="RoomCanvas_MouseMove"
                                MouseLeftButtonUp="RoomCanvas_MouseLeftButtonUp"
                                MouseWheel="RoomCanvas_MouseWheel"/>
            <Canvas x:Name="TilePaintCanvas"
                Background="Transparent"
                IsHitTestVisible="false"
                Panel.ZIndex="50"
                MouseLeftButtonDown="TilePaintCanvas_MouseLeftButtonDown"
                MouseMove="TilePaintCanvas_MouseMove"
                MouseLeftButtonUp="TilePaintCanvas_MouseLeftButtonUp"
                MouseWheel="RoomCanvas_MouseWheel"/>
            <TextBlock x:Name="CanvasInfoText"
                   Text="Drag objects from the left panel to place them in the room"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Foreground="{DynamicResource PrimaryTextBrush}"
                   Opacity="0.5"/>
          </Grid>
        </ScrollViewer>

        <StackPanel Grid.Column="1"
                Background="{DynamicResource ControlBackgroundBrush}"
                Margin="6"
                VerticalAlignment="Stretch">

          <GroupBox Header="Tile Layers" Margin="0,0,0,8">
            <StackPanel>
              <ListBox x:Name="LayerListBox"
                   Height="140"
                   SelectionChanged="LayerListBox_SelectionChanged"/>
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Add"  Click="AddLayer_Click"       Margin="1"/>
                <Button Content="Del"  Click="RemoveLayer_Click"    Margin="1"/>
                <Button Content="↑"    Click="MoveLayerUp_Click"    Margin="1"/>
                <Button Content="↓"    Click="MoveLayerDown_Click"  Margin="1"/>
              </StackPanel>
            </StackPanel>
          </GroupBox>

          <GroupBox Header="Tile Palette" Margin="0,0,0,8">
            <StackPanel>
              <ScrollViewer Height="140" 
                           HorizontalScrollBarVisibility="Auto" 
                           VerticalScrollBarVisibility="Auto"
                           MouseWheel="TilePalette_MouseWheel"
                           Name="TilePaletteScrollViewer">
                <WrapPanel x:Name="TilePalettePanel" Orientation="Horizontal" Width="200" />
              </ScrollViewer>
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,5,0,0">
                <Button Content="Zoom In" Click="TilePaletteZoomIn_Click" Width="60" Margin="2"/>
                <Button Content="Zoom Out" Click="TilePaletteZoomOut_Click" Width="60" Margin="2"/>
              </StackPanel>
            </StackPanel>
          </GroupBox>

          <GroupBox Header="Tile Properties">
              <StackPanel Margin="16">
                <TextBlock Text="Tile Z:" FontWeight="Bold" Foreground="{DynamicResource PrimaryTextBrush}"/>
              <TextBox x:Name="TileHeightBox" Text="800"/>
              <CheckBox x:Name="TileCollisionBox" Content="Collidable"/>
            </StackPanel>
          </GroupBox>
          
          <StackPanel Orientation="Horizontal" Margin="0,4">
            <TextBlock Text="Tileset:" VerticalAlignment="Center"/>
            <ComboBox x:Name="TilesetPicker"
              Width="140"
              SelectionChanged="TilesetPicker_SelectionChanged"/>
            <Button Content="↻" Click="RefreshTileset_Click" Width="25" Margin="2,0,0,0" ToolTip="Refresh Tilesets"/>
          </StackPanel>

        </StackPanel>
      </Grid>
    </Border>


  </Grid>
</UserControl>